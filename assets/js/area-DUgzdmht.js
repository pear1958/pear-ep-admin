import{g as K}from"./common-Cd952OuC.js";import{d as P,aV as m,aG as E,bU as V,bE as z,a_ as O,o as g,b as S,O as f,bJ as h,F as L,aY as B,a as N,aT as $,A as y,bc as j}from"./index-iSRBwhZQ.js";import"./index-uGdeCMGa.js";const F={class:"flex align-center gap-2.5"},M=P({name:"AreaSelect",__name:"AreaSelect",props:{modelValue:{type:Object,default:()=>({})},provinceKey:{type:String,default:"provinceCode"},cityKey:{type:String,default:"cityCode"},countyKey:{type:String,default:"countyCode"}},emits:["change"],setup(k,{emit:_}){const b=_,o=k,r=m(""),n=m(""),t=m(""),C=m([]),e=m([]),c=m([]),d=m(!1),s=m(!1),v=m(!1);E(()=>{U()});async function U(){try{d.value=!0;const{code:i,data:a,msg:l}=await K({level:0});if(!String(i).startsWith("2"))return V.error(l||"查询省级区域失败");C.value=a}finally{d.value=!1}}z(()=>o.modelValue,(i,a)=>{i&&(Object.keys(i).length&&(r.value=i[o.provinceKey],n.value=i[o.cityKey],t.value=i[o.countyKey]),r.value&&!a&&(s.value=!0,K({level:1,pcode:r.value}).then(l=>{if(!String(l.code).startsWith("2"))return V.error(l.msg||"查询市级区域失败");e.value=l.data}).finally(()=>{s.value=!1})),n.value&&!a&&(v.value=!0,K({level:2,pcode:n.value}).then(l=>{if(!String(l.code).startsWith("2"))return V.error(l.msg||"查询区级区域失败");c.value=l.data}).finally(()=>{v.value=!1})))},{immediate:!0});const W=async i=>{if(i)try{s.value=!0,e.value=[];const{code:a,data:l,msg:p}=await K({level:1,pcode:r.value});if(!String(a).startsWith("2"))return V.error(p||"查询市级区域失败");e.value=l}finally{s.value=!1}n.value="",t.value="",A()},x=async i=>{if(i)try{v.value=!0,c.value=[];const{code:a,data:l,msg:p}=await K({level:2,pcode:n.value});if(!String(a).startsWith("2"))return V.error(p||"查询区级区域失败");c.value=l}finally{v.value=!1}t.value="",A()},D=()=>{A()},A=()=>{const{provinceKey:i,cityKey:a,countyKey:l}=o,p={[i]:r.value,[a]:n.value,[l]:t.value};o.modelValue[i]=r.value,o.modelValue[a]=n.value,o.modelValue[l]=t.value,b("change",p)};return(i,a)=>{const l=O("el-option"),p=O("el-select");return g(),S("div",F,[f(p,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=u=>r.value=u),placeholder:"省",clearable:"",onChange:W,filterable:"",loading:d.value,"loading-text":"加载中..."},{default:h(()=>[(g(!0),S(L,null,B(C.value,u=>(g(),N(l,{key:u.code,label:u.name,value:u.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),f(p,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=u=>n.value=u),placeholder:"市",clearable:"",disabled:!r.value,onChange:x,filterable:"",loading:s.value,"loading-text":"加载中..."},{default:h(()=>[(g(!0),S(L,null,B(e.value,u=>(g(),N(l,{key:u.code,label:u.name,value:u.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","loading"]),f(p,{modelValue:t.value,"onUpdate:modelValue":a[2]||(a[2]=u=>t.value=u),placeholder:"区",clearable:"",disabled:!r.value||!n.value,onChange:D,filterable:"",loading:v.value,"loading-text":"加载中..."},{default:h(()=>[(g(!0),S(L,null,B(c.value,u=>(g(),N(l,{key:u.code,label:u.name,value:u.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","loading"])])}}}),G=P({name:"AreaCascader",__name:"AreaCascader",props:{modelValue:{type:Object,default:()=>({})},provinceKey:{type:String,default:"provinceCode"},cityKey:{type:String,default:"cityCode"},countyKey:{type:String,default:"countyCode"}},emits:["change"],setup(k,{emit:_}){const b=_,o=k,r=m([]);z(()=>o.modelValue,(e,c)=>{const{provinceKey:d,cityKey:s,countyKey:v}=o;e&&Object.keys(e).length&&!c&&e[d]&&e[s]&&e[v]&&(r.value=[e[d],e[s],e[v]])},{immediate:!0});const n={lazy:!0,async lazyLoad(e,c){const{level:d}=e,s={level:d};console.log("node",e),d>=1&&(s.pcode=e.value);const v=await t(s);c(v)}};function t(e){return new Promise(async(c,d)=>{try{const{code:s,data:v,msg:U}=await K(e);String(s).startsWith("2")||(V.error(U||`查询${["省","市","区"][e.level]}级区域失败`),d([]));const W=v.map(x=>({label:x.name,value:x.code,leaf:e.level>=2}));c(W)}finally{d([])}})}const C=e=>{if(!(e!=null&&e.length))return;const{provinceKey:c,cityKey:d,countyKey:s}=o,v={provinceKey:e[0],cityKey:e[1],countyKey:e[2]};o.modelValue[c]=e[0],o.modelValue[d]=e[1],o.modelValue[s]=e[2],b("change",v)};return(e,c)=>{const d=O("el-cascader");return g(),S("div",null,[f(d,{props:n,modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=s=>r.value=s),onChange:C},null,8,["modelValue"])])}}}),I={class:"mt-2"},J={class:"mt-2"},T={class:"mt-2"},Y={class:"mt-2"},R=P({__name:"area",setup(k){const _=$({key1:"test-1",key2:"test-2"}),b=$({key1:"test-a",key2:"test-b",provinceCode:"230000",cityCode:"230300",countyCode:"230305"}),o=n=>{console.log("data1",n)},r=n=>{console.log("data2",n)};return(n,t)=>{const C=O("el-card");return g(),S("div",null,[f(C,null,{header:h(()=>t[2]||(t[2]=[y("span",null,"省市区(下拉选择)",-1)])),default:h(()=>[y("div",null,[f(M,{modelValue:_,"onUpdate:modelValue":t[0]||(t[0]=e=>_=e),onChange:o},null,8,["modelValue"]),y("div",I,[t[3]||(t[3]=y("div",null,"v-model绑定的数据：",-1)),y("div",J,j(_),1)])])]),_:1}),f(C,{class:"mt-4"},{header:h(()=>t[4]||(t[4]=[y("span",null,"省市区(级联选择)",-1)])),default:h(()=>[y("div",null,[f(G,{modelValue:b,"onUpdate:modelValue":t[1]||(t[1]=e=>b=e),onChange:r},null,8,["modelValue"]),y("div",T,[t[5]||(t[5]=y("div",null,"v-model绑定的数据：",-1)),y("div",Y,j(b),1)])])]),_:1})])}}});export{R as default};
