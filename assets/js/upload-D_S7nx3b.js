import{d as B,aV as w,o as p,b as m,aZ as X,ax as J,bR as E,x as ee,a_ as S,F as T,aY as te,a as $,z as b,A as F,bO as D,O as I,bJ as se,u as L,c4 as q,bS as oe,bU as H}from"./index-iSRBwhZQ.js";import{u as ne,a as ae}from"./index-uGdeCMGa.js";const ie=B({name:"Dragger",__name:"Dragger",props:{onFile:{type:Function,required:!0}},setup(i){const x=w(!1),t=i,h=(f,n)=>{f.preventDefault(),x.value=n},k=f=>{var r;f.preventDefault(),x.value=!1;const n=((r=f.dataTransfer)==null?void 0:r.files)||[];t.onFile(n)};return(f,n)=>(p(),m("div",{class:J(["dragger-box",{"is-dragover":x.value}]),onDragover:n[0]||(n[0]=r=>h(r,!0)),onDragleave:n[1]||(n[1]=r=>h(r,!1)),onDrop:k},[X(f.$slots,"default",{},void 0,!0)],34))}}),le=E(ie,[["__scopeId","data-v-ad39e96e"]]),ce={class:"upload-box"},re=["onClick"],ue=["src"],de=["onClick"],pe=["onClick"],fe=["onClick"],ve=["onClick"],ge=["accept"],he=B({name:"Upload",__name:"index",props:{fileList:{type:Array,default:[]},action:{type:String,require:!0},activeIndex:{type:Number},maxLength:{type:Number,default:10},showReplace:{type:Boolean,default:!1},showActive:{type:Boolean,default:!1},beforeUpload:{type:Function},onProgress:{type:Function},onSuccess:{type:Function},onError:{type:Function},onChange:{type:Function},onRemove:{type:Function},headers:{type:Object},name:{type:String,default:"file"},data:{type:Object},withCredentials:{type:Boolean,default:!1},accept:{type:String}},emits:["update:fileList","update:activeIndex"],setup(i,{emit:x}){const t=i;t.showActive&&t.activeIndex==null&&console.error("未绑定activeIndex");const h=w(!1),k=w(0),f=ee(()=>t.fileList.map(s=>s.src)),n=x;let r="add",l;const u=w(),v=()=>{L(u).click()},W=s=>{const e=s.target.files;e&&(V(e),L(u).value="")},V=s=>{Array.from(s).forEach(d=>{if(!t.beforeUpload){A(d);return}const a=t.beforeUpload(d);a&&(a instanceof Promise&&a.then(C=>A(C)),A(d))})},U=(s,e)=>{const d=t.fileList.map(a=>a.uid===s.uid?{...a,...e}:a);n("update:fileList",d)},A=s=>{const e={uid:Date.now()+"upload-file",name:s.name,size:s.size,percent:0,status:"ready",raw:s,src:"",response:null},d=new FileReader;d.readAsDataURL(s),d.onload=a=>{var j;const C=(j=a.target)==null?void 0:j.result;e.src=C;const o=q(t.fileList);r=="add"&&o.push(e),r=="replace"&&(o[l]=e),n("update:fileList",o),r="add";const{name:g,data:y,action:G,headers:K,withCredentials:Q,onProgress:P,onSuccess:N,onError:M,onChange:_}=t,R=new FormData;R.append(g,s),y&&Object.keys(y).forEach(c=>R.append(c,y[c])),oe.post(G,R,{headers:{...K,"Content-Type":"multipart/form-data"},withCredentials:Q,onUploadProgress:c=>{const z=Math.round(c.loaded*100/c.total)||0;U(e,{percent:z,status:"uploading"}),e.status="uploading",e.percent=z,P&&P(z,e)}}).then(c=>{console.log("--成功--",c),U(e,{status:"success",response:c.data}),e.status="success",e.response=c.data,N&&N(c.data,e),_&&_(e)}).catch(c=>{console.log("err",c),U(e,{status:"error",error:c}),e.status="error",e.error=c,M&&M(c,e),_&&_(e)})}},Y=s=>{l=s,r="replace",v()},O=s=>{const e=q(t.fileList);if(t.showActive){const a=s<t.activeIndex,C=!!(s==t.activeIndex&&s==e.length-1&&e[s-1]);if(a||C){let o=t.activeIndex;o--,n("update:activeIndex",o)}}const d=e.splice(s,1);n("update:fileList",e),t.onRemove&&t.onRemove(d[0])},Z=s=>{k.value=s,h.value=!0};return(s,e)=>{const d=S("el-progress"),a=S("Iconify"),C=S("ImgViewer");return p(),m("div",ce,[(p(!0),m(T,null,te(i.fileList,(o,g)=>(p(),m("div",{key:o.uid,class:J(["uploaded",{active:i.showActive&&i.activeIndex==g}]),onClick:y=>i.showActive&&n("update:activeIndex",g)},[["ready","uploading"].includes(o.status)?(p(),$(d,{key:0,type:"circle",percentage:o.percent},null,8,["percentage"])):b("",!0),["success",void 0].includes(o.status)?(p(),m(T,{key:1},[F("img",{class:"img",src:o.src},null,8,ue),i.showReplace?(p(),m("div",{key:0,class:"replace-box",onClick:D(y=>Y(g),["stop"])}," 替换图片 ",8,de)):b("",!0),i.showActive&&i.activeIndex==g?(p(),m("div",{key:1,class:"select-del-icon",onClick:D(y=>O(g),["stop"])},[I(a,{icon:"close"})],8,pe)):b("",!0),g!==i.activeIndex?(p(),m("div",{key:2,class:"hover-del-icon",onClick:D(y=>O(g),["stop"])},[I(a,{icon:"delete"})],8,fe)):b("",!0),F("div",{class:"hover-preview-icon",onClick:D(y=>Z(g),["stop"])},[I(a,{icon:"zoom-in"})],8,ve)],64)):b("",!0),["error"].includes(o.status)?(p(),$(d,{key:2,type:"circle",percentage:o.percent,status:"exception"},null,8,["percentage"])):b("",!0)],10,re))),128)),i.fileList.length<i.maxLength?(p(),$(le,{key:0,onFile:o=>V(o)},{default:se(()=>[F("div",{class:"upload",onClick:v},[I(a,{icon:"plus"})])]),_:1},8,["onFile"])):b("",!0),F("input",{class:"file-input",style:{display:"none"},ref_key:"fileInputRef",ref:u,onChange:W,type:"file",accept:i.accept,multiple:!1},null,40,ge),I(C,{visible:h.value,"onUpdate:visible":e[0]||(e[0]=o=>h.value=o),imgList:f.value,initIndex:k.value},null,8,["visible","imgList","initIndex"])])}}}),me=E(he,[["__scopeId","data-v-86e2cc92"]]),ye={class:"page-box bg-white dark:bg-dark p-4"},xe=B({__name:"upload",setup(i){const x="http://xxxxxx/xx"+ae,t=w([]),h=w(0),k=l=>l.size/1024>12e3?(console.log("file-to-big 超过了12M"),!1):!0,f=l=>{console.log("onFileChange-size",l.size/1024)},n=(l,u)=>{String(l==null?void 0:l.code).startsWith("200")||(H.error((l==null?void 0:l.msg)||"上传失败"),t.value=L(t).filter(v=>v.uid!==u.uid))},r=(l,u)=>{H.error("上传失败"),t.value=L(t).filter(v=>v.uid!==u.uid)};return(l,u)=>(p(),m("div",ye,[I(me,{"file-list":t.value,"onUpdate:fileList":u[0]||(u[0]=v=>t.value=v),"active-index":h.value,"onUpdate:activeIndex":u[1]||(u[1]=v=>h.value=v),action:x,"before-upload":k,"on-change":f,"on-success":n,"on-error":r,headers:L(ne),showReplace:"",showActive:""},null,8,["file-list","active-index","headers"])]))}}),ke=E(xe,[["__scopeId","data-v-607df280"]]);export{ke as default};
