import{c as F,g as $,d as J,aV as L,bF as G,a_ as y,o as x,a as V,bJ as b,O as k,N as S,A as C,u as j,bX as T,b as z,F as q,aY as W,c3 as X,c4 as Y,bU as R,bR as Z,bc as H}from"./index-iSRBwhZQ.js";import{u as K}from"./platformConfig-DnzqOHza.js";var B={exports:{}};(function(I,w){(function(m,A){I.exports=A()})(F,function(){function m(e){var p=[];return e.AMapUI&&p.push(A(e.AMapUI)),e.Loca&&p.push(h(e.Loca)),Promise.all(p)}function A(e){return new Promise(function(p,i){var r=[];if(e.plugins)for(var s=0;s<e.plugins.length;s+=1)n.AMapUI.plugins.indexOf(e.plugins[s])==-1&&r.push(e.plugins[s]);if(u.AMapUI===o.failed)i("前次请求 AMapUI 失败");else if(u.AMapUI===o.notload){u.AMapUI=o.loading,n.AMapUI.version=e.version||n.AMapUI.version,s=n.AMapUI.version;var l=document.body||document.head,t=document.createElement("script");t.type="text/javascript",t.src="https://webapi.amap.com/ui/"+s+"/main.js",t.onerror=function(a){u.AMapUI=o.failed,i("请求 AMapUI 失败")},t.onload=function(){if(u.AMapUI=o.loaded,r.length)window.AMapUI.loadUI(r,function(){for(var a=0,c=r.length;a<c;a++){var f=r[a].split("/").slice(-1)[0];window.AMapUI[f]=arguments[a]}for(p();d.AMapUI.length;)d.AMapUI.splice(0,1)[0]()});else for(p();d.AMapUI.length;)d.AMapUI.splice(0,1)[0]()},l.appendChild(t)}else u.AMapUI===o.loaded?e.version&&e.version!==n.AMapUI.version?i("不允许多个版本 AMapUI 混用"):r.length?window.AMapUI.loadUI(r,function(){for(var a=0,c=r.length;a<c;a++){var f=r[a].split("/").slice(-1)[0];window.AMapUI[f]=arguments[a]}p()}):p():e.version&&e.version!==n.AMapUI.version?i("不允许多个版本 AMapUI 混用"):d.AMapUI.push(function(a){a?i(a):r.length?window.AMapUI.loadUI(r,function(){for(var c=0,f=r.length;c<f;c++){var v=r[c].split("/").slice(-1)[0];window.AMapUI[v]=arguments[c]}p()}):p()})})}function h(e){return new Promise(function(p,i){if(u.Loca===o.failed)i("前次请求 Loca 失败");else if(u.Loca===o.notload){u.Loca=o.loading,n.Loca.version=e.version||n.Loca.version;var r=n.Loca.version,s=n.AMap.version.startsWith("2"),l=r.startsWith("2");if(s&&!l||!s&&l)i("JSAPI 与 Loca 版本不对应！！");else{s=n.key,l=document.body||document.head;var t=document.createElement("script");t.type="text/javascript",t.src="https://webapi.amap.com/loca?v="+r+"&key="+s,t.onerror=function(a){u.Loca=o.failed,i("请求 AMapUI 失败")},t.onload=function(){for(u.Loca=o.loaded,p();d.Loca.length;)d.Loca.splice(0,1)[0]()},l.appendChild(t)}}else u.Loca===o.loaded?e.version&&e.version!==n.Loca.version?i("不允许多个版本 Loca 混用"):p():e.version&&e.version!==n.Loca.version?i("不允许多个版本 Loca 混用"):d.Loca.push(function(a){a?i(a):i()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var o;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(o||(o={}));var n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},d={AMap:[],AMapUI:[],Loca:[]},M=[],U=function(e){typeof e=="function"&&(u.AMap===o.loaded?e(window.AMap):M.push(e))};return{load:function(e){return new Promise(function(p,i){if(u.AMap==o.failed)i("");else if(u.AMap==o.notload){var r=e.key,s=e.version,l=e.plugins;r?(window.AMap&&location.host!=="lbs.amap.com"&&i("禁止多种API加载方式混用"),n.key=r,n.AMap.version=s||n.AMap.version,n.AMap.plugins=l||n.AMap.plugins,u.AMap=o.loading,s=document.body||document.head,window.___onAPILoaded=function(a){if(delete window.___onAPILoaded,a)u.AMap=o.failed,i(a);else for(u.AMap=o.loaded,m(e).then(function(){p(window.AMap)}).catch(i);M.length;)M.splice(0,1)[0]()},l=document.createElement("script"),l.type="text/javascript",l.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+n.AMap.version+"&key="+r+"&plugin="+n.AMap.plugins.join(","),l.onerror=function(a){u.AMap=o.failed,i(a)},s.appendChild(l)):i("请填写key")}else if(u.AMap==o.loaded)if(e.key&&e.key!==n.key)i("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(r=[],e.plugins)for(s=0;s<e.plugins.length;s+=1)n.AMap.plugins.indexOf(e.plugins[s])==-1&&r.push(e.plugins[s]);r.length?window.AMap.plugin(r,function(){m(e).then(function(){p(window.AMap)}).catch(i)}):m(e).then(function(){p(window.AMap)}).catch(i)}else if(e.key&&e.key!==n.key)i("多个不一致的 key");else if(e.version&&e.version!==n.AMap.version)i("不允许多个版本 JSAPI 混用");else{var t=[];if(e.plugins)for(s=0;s<e.plugins.length;s+=1)n.AMap.plugins.indexOf(e.plugins[s])==-1&&t.push(e.plugins[s]);U(function(){t.length?window.AMap.plugin(t,function(){m(e).then(function(){p(window.AMap)}).catch(i)}):m(e).then(function(){p(window.AMap)}).catch(i)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,n={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},d={AMap:[],AMapUI:[],Loca:[]}}}})})(B);var Q=B.exports;const ee=$(Q),oe=""+new URL("../png/marker-JPCZIn3M.png",import.meta.url).href,ne={class:"map-box"},ae={class:"mt-1.5"},te=J({name:"mapAddrDrawer",__name:"AddrDrawer",props:{visible:{type:Boolean,required:!0},mapData:{validator:()=>!0,required:!0}},emits:["update:visible","update:mapData"],setup(I,{emit:w}){const m=w,A=I,h=L(),o=L("");let n,u,d={addr:"",lng:"",lat:""};const M=L([]);G(async()=>{if(A.visible){if(await p(),!X(A.mapData))return;d=Y(A.mapData),Reflect.has(d,"lng")||(d.lng=""),Reflect.has(d,"lat")||(d.lat=""),Reflect.has(d,"addr")||(d.addr="");const{addr:l,lng:t,lat:a}=d;o.value=l,t&&a&&i([Number(t),Number(a)],l);return}n!=null&&n.destroy()&&(n==null||n.clearEvents("click")),M.value.splice(0)});const U=()=>{m("update:visible",!1)},e=()=>{U(),m("update:mapData",d)};function p(){const{securityJsCode:l,key:t}=K().mapConfig;return new Promise((a,c)=>{window._AMapSecurityConfig={securityJsCode:l},ee.load({key:t,version:"2.0",plugins:["AMap.Geocoder","AMap.AutoComplete"]}).then(f=>{var v,g;n=new f.Map(h.value,{zoom:15,layers:[new f.TileLayer.Satellite,new f.TileLayer.RoadNet],center:[((v=A.mapData)==null?void 0:v.lng)||104.060791,((g=A.mapData)==null?void 0:g.lat)||30.543995]}),u=new f.Geocoder,n.on("click",_=>{const D=_.lnglat.getLng(),P=_.lnglat.getLat(),E=[D,P];if(!D||!P){R.warning("打点失败");return}u.getAddress(E,function(O,N){O==="complete"&&N.regeocode?(o.value=N.regeocode.formattedAddress,n.clearMap(),i(E,o.value,!1),d={addr:o.value,lng:D,lat:P}):R.error("根据经纬度查询地址失败")})}),a()}).catch(f=>{console.log("err",f),c()})})}const i=(l,t,a=!0)=>{const c=new AMap.Marker({position:l,icon:new AMap.Icon({image:oe,size:new AMap.Size(46,46),imageSize:new AMap.Size(46,46),imageOffset:new AMap.Pixel(0,9)}),anchor:"bottom-center"});c.setLabel({direction:"top",offset:new AMap.Pixel(0,9),content:`<div>${t||""}</div>`}),n.add(c),a&&n.setCenter(l)},r=l=>{if(console.log("query",l),!l){M.value=[];return}new AMap.Autocomplete({city:"全国"}).search(l,(a,c)=>{const{tips:f}=c;console.log("result",c),Array.isArray(f)&&(M.value=f.filter(v=>{var g,_;return((g=v.location)==null?void 0:g.lng)&&((_=v.location)==null?void 0:_.lat)}).map(v=>({label:v.name,value:v.name,lng:Number(v.location.lng),lat:Number(v.location.lat)})))})},s=l=>{const t=j(M).find(f=>f.value==l);if(!t)return;const{lng:a,lat:c}=t;i([a,c],l),d={addr:l,lng:a,lat:c}};return(l,t)=>{const a=y("el-option"),c=y("el-select"),f=y("el-button"),v=y("el-drawer");return x(),V(v,{modelValue:I.visible,title:"地址选择",onClose:U,size:422},{footer:b(()=>[k(f,{onClick:U},{default:b(()=>t[1]||(t[1]=[S("取消")])),_:1}),k(f,{type:"primary",onClick:e},{default:b(()=>t[2]||(t[2]=[S("确定")])),_:1})]),default:b(()=>[C("div",ne,[k(c,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=g=>o.value=g),placeholder:"输入查询或者点击选择",filterable:"",remote:"","remote-method":j(T)(r,700),style:{width:"100%"},onChange:s},{default:b(()=>[(x(!0),z(q,null,W(M.value,g=>(x(),V(a,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method"]),C("div",ae,[C("div",{id:"mapDiv",ref_key:"mapRef",ref:h},null,512)])])]),_:1},8,["modelValue"])}}}),ie=Z(te,[["__scopeId","data-v-4acda605"]]),le={class:"bg-white dark:bg-dark p-4"},ue={class:"my-5"},de=J({__name:"mapAddrDrawer",setup(I){const w=L(!1),m=L(null),A=()=>{w.value=!0};return(h,o)=>{const n=y("el-button");return x(),z("div",le,[k(n,{onClick:A},{default:b(()=>o[2]||(o[2]=[S("点击打开")])),_:1}),C("div",ue,[C("div",null,"数据: "+H(m.value),1)]),k(ie,{visible:w.value,"onUpdate:visible":o[0]||(o[0]=u=>w.value=u),"map-data":m.value,"onUpdate:mapData":o[1]||(o[1]=u=>m.value=u)},null,8,["visible","map-data"])])}}});export{de as default};
